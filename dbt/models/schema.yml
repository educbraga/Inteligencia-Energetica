version: 2

sources:
  - name: staging
    tables:
      - name: disponibilidade_usina_2025_07
      - name: disponibilidade_usina_2025_08
      - name: disponibilidade_usina_2025_09
      - name: geracao_usina_2_2025_01
        identifier: '"GERACAO_USINA_2_2025-01"'
      - name: geracao_usina_2_2025_02
        identifier: '"GERACAO_USINA_2_2025-02"'
      - name: geracao_usina_2_2025_03
        identifier: '"GERACAO_USINA_2_2025-03"'
      - name: geracao_usina_2_2025_04
        identifier: '"GERACAO_USINA_2_2025-04"'
      - name: geracao_usina_2_2025_05
        identifier: '"GERACAO_USINA_2_2025-05"'
      - name: geracao_usina_2_2025_06
        identifier: '"GERACAO_USINA_2_2025-06"'
      - name: geracao_usina_2_2025_07
        identifier: '"GERACAO_USINA_2_2025-07"'
      - name: geracao_usina_2_2025_08
        identifier: '"GERACAO_USINA_2_2025-08"'
      - name: geracao_usina_2_2025_09
        identifier: '"GERACAO_USINA_2_2025-09"'

models:
  # Testes para o modelo de staging (já existentes)
  - name: stg_usina_disp
    columns:
      - name: instante
        tests: [not_null]
      - name: id_subsistema
        tests: [not_null]

  # Testes para o modelo de staging de geração
  - name: stg_usina_geracao
    description: "Union dinâmico de todas as tabelas de geração de usina"
    columns:
      - name: mes_referencia
        description: "Mês de referência extraído do nome da tabela"
        tests: [not_null]
      - name: instante
        description: "Data e hora da medição"
        tests: [not_null]
      - name: id_subsistema
        description: "Identificador do subsistema"
        tests: [not_null]
      - name: val_geracao_mw
        description: "Valor de geração em MW (pode ser nulo quando usina não está gerando)"
        # Valores nulos são permitidos - teste personalizado em tests/assert_val_geracao_non_negative.sql
      - name: ceg
        description: "Código da usina geradora"
        tests: [not_null]
      - name: id_ons
        description: "Identificador ONS"
        tests: [not_null]
      - name: source_table_name
        description: "Nome da tabela de origem dos dados"
        tests: [not_null]

  # Testes para o modelo de staging de geração - somente GO
  - name: stg_usina_geracao_go
    columns:
      - name: instante
        tests: [not_null]
      - name: id_estado
        tests: 
          - not_null
          - accepted_values:
              values: ['GO']
      - name: val_geracao_mw
        tests: [not_null]
      - name: ceg
        tests: [not_null]
      - name: id_ons
        tests: [not_null]

  # Testes para a dimensão de usina
  - name: dim_usina
    columns:
      - name: id_dim_usina
        description: "Chave primária da dimensão de usina."
        tests:
          - unique
          - not_null

  # Testes para a dimensão de localidade
  - name: dim_localidade
    columns:
      - name: id_dim_localidade
        description: "Chave primária da dimensão de localidade."
        tests:
          - unique
          - not_null

  # Testes para a dimensão de tempo
  - name: dim_tempo
    columns:
      - name: id_dim_tempo
        description: "Chave primária da dimensão de tempo."
        tests:
          - unique
          - not_null

  # Testes para a tabela de fatos
  - name: fact_disponibilidade
    columns:
      - name: id_dim_usina
        description: "Chave estrangeira para a dim_usina."
        tests:
          - relationships:
              to: ref('dim_usina')
              field: id_dim_usina

      - name: id_dim_localidade
        description: "Chave estrangeira para a dim_localidade."
        tests:
          - relationships:
              to: ref('dim_localidade')
              field: id_dim_localidade

      - name: id_dim_tempo
        description: "Chave estrangeira para a dim_tempo."
        tests:
          - relationships:
              to: ref('dim_tempo')
              field: id_dim_tempo
